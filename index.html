<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/style.css">
    <link rel="manifest" href="manifest.json">
    <!-- ios support -->
    <link rel="apple-touch-icon" href="images/icons/icon-72x72.png">
    <link rel="apple-touch-icon" href="images/icons/icon-96x96.png">
    <link rel="apple-touch-icon" href="images/icons/icon-128x128.png">
    <link rel="apple-touch-icon" href="images/icons/icon-144x144.png">
    <link rel="apple-touch-icon" href="images/icons/icon-152x152.png">
    <link rel="apple-touch-icon" href="images/icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="images/icons/icon-384x384.png">
    <link rel="apple-touch-icon" href="images/icons/icon-512x512.png">
    <meta name="apple-mobile-web-app-status-bar" content="#db4938">
    <meta name="theme-color" content="#db4938">
    <title>Dev'Coffee PWA</title>
  </head>
  <body>
    <main>
      <nav>
        <h1>Dev'Coffee</h1>
        <ul>
          <li>Home</li>
          <li>About</li>
          <li>Blog</li>
        </ul>
      </nav>
      <div class="container"></div>
    </main>
    <script src="js/app.js"></script>
   <h1>Open WebCam Using JavaScript</h1>
   <br/>
   <button id="startBtn" onclick="openCam()">Open Webcam</button>
    <button id="captureBtn" onclick="captureImage()">Take picture</button>
     <button id="stopBtn" onclick="stopCam()">Stop Webcam</button>
   <button id="downloadBtn" onclick="downloadImage()">Save picture</button>
   <br/><br/>
   <video id="videoCam"></video>
    <canvas id="canvas" style="display: none;"></canvas>
<img id="capturedImage" style="display: none;">
   <script>
      let videoStream;
   let video = document.getElementById('videoCam');
   let canvas = document.getElementById('canvas');
   let capturedImage = document.getElementById('capturedImage');

      function openCam(){
         let All_mediaDevices=navigator.mediaDevices
         if (!All_mediaDevices || !All_mediaDevices.getUserMedia) {
            console.log("getUserMedia() not supported.");
            return;
         }
         All_mediaDevices.getUserMedia({
            audio: true,
            video: true
         })
         .then(function(vidStream) {
            var video = document.getElementById('videoCam');
            if ("srcObject" in video) {
               video.srcObject = vidStream;
            } else {
               video.src = window.URL.createObjectURL(vidStream);
            }
            video.onloadedmetadata = function(e) {
               video.play();
            }; // Video als Bild gespeicehrt
           videoStream = vidStream;
         })
         .catch(function(e) {
            console.log(e.name + ": " + e.message);
         });
      }
     function captureImage(){
      if(videoStream) {
         canvas.width = video.videoWidth;
         canvas.height = video.videoHeight;
         canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
         const imgDataUrl = canvas.toDataURL('image/png');
         capturedImage.src = canvas.toDataURL('image/png');
         capturedImage.style.display = 'block';

        // Speichern
        sessionStorage.setItem('capturedImage', imgDataUrl);
      }}

 function stopCam(){
        if(videoStream) {
           const tracks = videoStream.getTracks();
           tracks.forEach(track => track.stop());
           videoStream = null;
        }
     }

 function downloadImage() {
        if (capturedImage.src) {
           const a = document.createElement('a');
           a.href = capturedImage.src;
           a.download = 'captured_image.png';
           a.click();
        }
     }

     if ('caches' in window) {
    caches.match('/images/captured_image.png')
      .then(function (response) {
        if (response) {
          return response.blob();
        }
      })
      .then(function (blob) {
        if (blob) {
          const img = document.getElementById('capturedImage');
          img.src = URL.createObjectURL(blob);
          img.style.display = 'block';
        }
      })
      .catch(function (error) {
        console.error('Fehler beim Laden des Bildes aus dem Cache:', error);
      });
  }
  
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
      .then(function(registration) {
        console.log('Service Worker registered with scope:', registration.scope);
      })
      .catch(function(error) {
        console.error('Service Worker registration failed:', error);
      });
  }



     
   </script>
  </body>
</html>
